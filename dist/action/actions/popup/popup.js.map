{"version":3,"sources":["../../../../src/action/actions/popup/popup.js"],"names":[],"mappings":"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","file":"popup.js","sourcesContent":["import sandbox from 'scalejs.sandbox';\r\nimport { createViewModel } from 'scalejs.metadataFactory';\r\nimport { registerTemplates, registerBindings, template } from 'scalejs.mvvm';\r\nimport popup from 'scalejs.popup';\r\nimport { notify } from 'scalejs.messagebus';\r\nimport ko from 'knockout';\r\nimport mustache from 'mustache';\r\n\r\nimport popupBindings from './popupBindings';\r\nimport popupTemplates from './popup.html';\r\nimport { registerActions } from '../../actionModule';\r\n\r\nconst merge = sandbox.object.merge;\r\nlet   popupRoot = popup.popupRoot;\r\n\r\nfunction popupAction(options) {\r\n    let context = this,\r\n        onHidePopup, actions, data, modal, merged, message = {};\r\n\r\n    actions = (options.actions || []).map(function (action) {\r\n        action.type = 'action';\r\n        return createViewModel.call(context, action);\r\n    });\r\n\r\n    data = this && this.data && this.data();\r\n    message.data = data;\r\n\r\n    if (data && options.message) {\r\n        if (!Array.isArray(data)) { data = [data] }\r\n        // check for selected items with unique ids in message\r\n        let selectedItems = options.message.match(/{{(selectedItems:[^{}]+)}}/g);\r\n        if (selectedItems) {\r\n            console.warn('Please refactor selected items message rendering out of popupAction', options);\r\n\r\n            // replace {{selectedItems:[uniqueID]}} with {{selectedItems}} for mustache rendering key\r\n            options.message = options.message.replace(selectedItems[0], '{{selectedItems}}');\r\n\r\n            // create array of unique ids for selected values, ie [\"poolNum\", \"PoolStatusCode\"]\r\n            selectedItems = selectedItems.map(function (item) {\r\n                return item.slice(item.indexOf(':') + 1, -2);\r\n            }).join().split(',');\r\n\r\n            // add data values to selectedItems key for rendering\r\n            message.selectedItems = data.map(function (datum) {\r\n                return selectedItems.reduce(function (prev, curr) {\r\n                    return prev + datum[curr] + ' ';\r\n                }, '');\r\n            });\r\n        }\r\n        options.message = mustache.render(options.message, message);\r\n    } else if (!options.message) {\r\n        options.message = '';\r\n    }\r\n\r\n    if (options.hidePopupAction) {\r\n        onHidePopup = createViewModel.call(context, options.hidePopupAction).action;\r\n    }\r\n\r\n    modal = typeof options.modal === 'undefined' || typeof options.modal === 'boolean' ? options.modal : evaluate(options.modal, this.getValue);\r\n    merged = merge(options, {\r\n        title: options.title,\r\n        message: options.message,\r\n        template: options.template,\r\n        actions: actions,\r\n        modal: modal,\r\n        options: options.children,\r\n        onHidePopup: onHidePopup,\r\n        context: this\r\n    });\r\n\r\n    //notify('showPopup',merged);\r\n    popup.onHidePopup(merged.onHidePopup);\r\n    popup.renderPopup(\r\n        template(merged.wrapperTemplate || 'popup_default_wrapper_template', {\r\n            hidePopup: popup.hidePopup,\r\n            title: merged.title || 'Popup',\r\n            modal: merged.modal || false,\r\n            popupContent: {\r\n                name: merged.template || 'popup_default_region_template',\r\n                data: merge(merged, {\r\n                    hidePopup: popup.hidePopup\r\n                })\r\n            }\r\n        })\r\n    );\r\n\r\n    if (options.hideDelay) {\r\n        setTimeout(closePopup, options.hideDelay);\r\n    }\r\n}\r\n\r\nfunction closePopup() {\r\n    popup.hidePopup();\r\n}\r\n\r\nfunction init() {\r\n    let popupDiv = document.querySelector('*[data-bind=\"render: popupRoot\"], *[data-bind=\"render:popupRoot\"]');\r\n    if (!popupDiv) {\r\n        let att = document.createAttribute('data-bind');\r\n        att.value = 'render: popupRoot';\r\n        popupDiv = document.createElement('div');\r\n        popupDiv.setAttributeNode(att);\r\n        document.body.insertBefore(popupDiv, document.body.lastChild.nextSibling)\r\n    }\r\n    ko.applyBindings({popupRoot}, popupDiv);\r\n}\r\n\r\ninit();\r\n\r\nregisterBindings(popupBindings);\r\nregisterTemplates(popupTemplates);\r\nregisterActions({ popup: popupAction, closePopup: closePopup });"]}