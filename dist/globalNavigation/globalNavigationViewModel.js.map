{"version":3,"sources":["../../src/globalNavigation/globalNavigationViewModel.js"],"names":[],"mappings":";;;;;kBAMwB,gB;;AANxB;;;;AACA;;AACA;;AACA;;;;AACA;;;;;;AAEe,SAAS,gBAAT,CAA0B,IAA1B,EAAgC;AAC3C,QAAI,SAAS,mBAAG,eAAH,CAAmB,KAAK,MAAxB,CAAb;AAAA,QACA,QAAQ,kBAAQ,MAAR,CAAe,KADvB;AAAA,QAEA,WAAW,qBAAW,QAFtB;AAAA,QAGA,aAAa,qBAAW,UAHxB;;AAKA,aAAS,YAAT,CAAsB,KAAtB,EAA6B;AACzB,eAAO,CAAC,SAAS,EAAV,EACF,MADE,CACM,UAAC,KAAD,EAAQ,IAAR;AAAA,mBAAiB,MAAM,MAAN,CAAa,CAAC,KAAK,IAAN,CAAb,EACzB,MADyB,CAClB,aAAa,KAAK,QAAlB,CADkB,CAAjB;AAAA,SADN,EAEmC,EAFnC,CAAP;AAGH;;AAED,aAAS,OAAT,CAAiB,UAAU,KAAV,EAAiB;AAC9B,6BAAW,MAAX,CAAkB,KAAlB,EAAyB,UAAU,SAAV,EAAqB;AAC1C,gBAAI,OAAO,MAAM,GAAN,CAAU,OAAV,CAAkB,QAAlB,EAA4B,UAAU,IAAV,GAAiB,MAAM,UAAU,IAAV,CAAe,OAAf,CAAuB,GAAvB,EAA2B,GAA3B,CAAvB,GAAyD,EAArF,CAAX;AACA,kCAAY,IAAZ,CAAiB,EAAE,OAAO,IAAT,EAAjB,EAAkC,UAAU,GAAV,EAAe,QAAf,EAAyB;AACvD,oBAAI,GAAJ,EAAS;AACL;AACH;AACD,oBAAI,QAAQ,EAAE,IAAF,CAAO,aAAa,MAAM,OAAN,CAAc,QAAd,IAA0B,QAA1B,GAAqC,CAAC,QAAD,CAAlD,CAAP,EAAsE,MAAtE,CAA6E,UAAU,IAAV,EAAgB;AACrG,2BAAO,QAAQ,oCAAqB,OAArB,CAA6B,IAA7B,MAAuC,CAAC,CAAvD;AACH,iBAFW,CAAZ;AAGA,wBAAQ,GAAR,CAAY,gBAAZ,EAA8B,KAA9B;;AAEA,iCAAO,OAAP,CAAe,QAAf;AACH,aAVD;AAWH,SAbD;AAcH,KAfD;;AAiBA,yBAAW,OAAX;;AAEA,WAAO,MAAM,IAAN,EAAY;AACf,kBAAU,QADK;AAEf,oBAAY;AAFG,KAAZ,CAAP;AAIH","file":"globalNavigationViewModel.js","sourcesContent":["import sandbox from 'scalejs.sandbox';\r\nimport { getRegisteredTypes } from 'scalejs.metadataFactory';\r\nimport {navigation, layout} from 'scalejs.navigation';\r\nimport ko from 'knockout';\r\nimport dataservice from 'dataservice';\r\n\r\nexport default function globalNavigation(node) {\r\n    var routes = ko.observableArray(node.routes),\r\n    merge = sandbox.object.merge,\r\n    navLinks = navigation.navLinks,\r\n    activeLink = navigation.activeLink;\r\n\r\n    function walkGetTypes(nodes) {\r\n        return (nodes || [])\r\n            .reduce( (types, node) => types.concat([node.type])\r\n            .concat(walkGetTypes(node.children)), []);\r\n    }\r\n\r\n    routes().forEach(function (route) {\r\n        navigation.addNav(route, function (routeInfo) {\r\n            var name = route.get.replace('{path}', routeInfo.path ? '_' + routeInfo.path.replace('/','_') : '');\r\n            dataservice.ajax({ 'uri': name }, function (err, metadata) {\r\n                if (err) {\r\n                    return;\r\n                }\r\n                var types = _.uniq(walkGetTypes(Array.isArray(metadata) ? metadata : [metadata])).filter(function (type) {\r\n                    return type && getRegisteredTypes().indexOf(type) === -1\r\n                });\r\n                console.log('Missing types:', types);\r\n\r\n                layout.content(metadata);\r\n            });\r\n        });\r\n    });\r\n\r\n    navigation.reRoute();\r\n\r\n    return merge(node, {\r\n        navLinks: navLinks,\r\n        activeLink: activeLink\r\n    });\r\n}\r\n"]}