{"version":3,"sources":["../../src/accordion/accordionBindings.js"],"names":[],"mappings":"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","file":"accordionBindings.js","sourcesContent":["/*global define */\r\nimport format from 'js-format';\r\nimport { computed } from 'knockout';\r\nimport 'ko-bindings/slideVisible';\r\n\r\n    function aggregateValues(node) {\r\n        var value;\r\n        if (node.getValue) {\r\n            value = [].concat(node.getValue());\r\n        } else if (node.mappedChildNodes) {\r\n            value = node.mappedChildNodes.reduce(function (values, childNode) {\r\n                var childValue = aggregateValues(childNode);\r\n                if(childValue) {\r\n                    values = values.concat(childValue);\r\n                }\r\n                return values;\r\n            }, [])\r\n        }\r\n        // convert objects to strings\r\n        value = value.map(function(value) {\r\n            if(typeof value === 'object') {\r\n                if (value.op) { delete value.op; } // we don't want to custom operators values in preview\r\n                return value = Object.keys(value).map(function(key) {\r\n                    if (Date.parse(value[key])) {\r\n                        return format('MM/DD/YYYY', new Date(value[key]));\r\n                    } else {\r\n                        return value[key];\r\n                    }\r\n                }).join(' ');\r\n            }\r\n            return value;\r\n        });\r\n        return value;\r\n    }\r\n    export default {\r\n        'accordion': function (ctx) {\r\n            return {\r\n                accordion: {\r\n                    itemsSource: this.sections,\r\n                    contentTemplate: 'form_self_template',\r\n                    headerPath: 'header',\r\n                    openPanel: 1\r\n                }\r\n            };\r\n        },\r\n        'accordion-header': function (ctx) {\r\n            var error = false, warning = false;\r\n            if(this.visibleMessages().length) {\r\n                this.visibleMessages().forEach(function (err) {\r\n                    if(err.severity == 1) {\r\n                        error = true;\r\n                    } else {\r\n                        warning = true;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return {\r\n                click: this.toggleVisibility,\r\n                css: {\r\n                    'fa-caret-down': this.visible(),\r\n                    'fa-caret-right': !this.visible(),\r\n                    'error': error,\r\n                    'warning': warning\r\n                }\r\n\r\n            }\r\n        },\r\n        'info': function (ctx){\r\n            return {\r\n                visible: ctx.$parent.options.showInfo\r\n            }\r\n        },\r\n        'accordion-expand-all': function(ctx) {\r\n            return {\r\n                click: function () {\r\n                    ctx.$parents[1].setAllSectionVisibility(true);\r\n                },\r\n                clickBubble: false\r\n            }\r\n        },\r\n        'accordion-collapse-all': function(ctx) {\r\n            return {\r\n                click: function () {\r\n                    ctx.$parents[1].setAllSectionVisibility(false);\r\n                },\r\n                clickBubble: false\r\n            }\r\n        },\r\n        'accordion-header-preview-text': function(ctx) {\r\n            var accordionChild = ctx.$parents[1].mappedChildNodes[ctx.$index()],\r\n                count = computed(function () {\r\n                    var values = aggregateValues(accordionChild);\r\n                    return values.length > 0  && values[0] ? values.length : '';\r\n                });\r\n\r\n            return {\r\n                text: count\r\n            };\r\n        },\r\n        'accordion-header-text': function (ctx) {\r\n            return {\r\n                text: typeof this.header === 'string' ? this.header : this.header.text\r\n            }\r\n        },\r\n        'accordion-header-error-text': function (ctx) {\r\n            var text = '', errors = 0, warnings = 0;\r\n            if(this.visibleMessages().length) {\r\n                text += '('\r\n                this.visibleMessages().forEach(function (err) {\r\n                    if(err.severity == 1) {\r\n                        errors = errors + 1;\r\n                    } else {\r\n                        warnings = warnings + 1;\r\n                    }\r\n                });\r\n                if(errors) {\r\n                    text += errors + ' error';\r\n                    if(errors > 1) {\r\n                        text += 's';\r\n                    }\r\n                    if(warnings) {\r\n                        text+= ', ';\r\n                    }\r\n                }\r\n                if(warnings) {\r\n                    text += warnings + ' warning'\r\n                    if(warnings > 1) {\r\n                        text += 's';\r\n                    }\r\n                }\r\n                text += ')';\r\n            }\r\n\r\n            return {\r\n                text: text\r\n            }\r\n        },\r\n        'accordion-sections': function () {\r\n            var visibleSections = this.sections.filter(function(section) {\r\n                return !section.isShown || section.isShown();\r\n            });\r\n            return {\r\n                foreach: visibleSections\r\n            }\r\n        }\r\n    }\r\n\r\n"]}